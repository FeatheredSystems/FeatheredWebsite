# Containers
In TytoDB, data is stored in containers, which are files where the database data is stored. The disk layout of the containers involves three key components: the metadata layout, the row structure, and tombstones.

## Metadata
Container files store metadata at the start of the file, organized as a tuple of two arrays:

The first array is a string array storing column names.
The second array is a byte array storing the type ID of each column.
When reading the metadata, the two arrays are interpreted by "matching" both arrays: the first column has the element zero as its name and the first element of the byte array as its type, and so on for the other columns.

## Row Layout and Pattern
Rows are stored right after the metadata as an array of elements of the same size (determined by the type size). They are placed as elements in a sequential list (akin to a Vec or Array), which means that reads from the disk can be performed using a relative pointer (index of that pseudo-array).

Diagram of a data storage layout showing a metadata block followed by a sequential array of fixed-size rows, each indexed for relative pointer access.

## Tombstones
After deleting a row, the space on the disk is filled with "full" bytes (0xFF, also represented as 255u8), marking that row as a tombstone. Afterwards, the pointer to that row is pushed into an in-memory BTreeSet, called the graveyard, so the space can be recycled later by having new data overwrite it. However, this does not guarantee that the space will be reused with every insert. When a row is inserted, it either gets the index at the end of the file if the graveyard is empty or pops a pointer from the structure. This pointer can be lost if the program rolls back or crashes. An operation called Vacuum is available to clean up the tombstones left behind.

Note: The graveyard has a limited and constant capacity of 12,500 pointers, freeing excess pointers if it becomes full.

```
+-------------------------------------------------------------+
|                         CONTAINER                           |
+-------------------------------------------------------------+
|                          METADATA                           |
|  ---------------------------------------------------------  |
|  [ Column Names Array ]   [ Type IDs Array ]                |
|       "id"   "name" ...   2 (INT)   6 (TEXT) ...            |
|  ---------------------------------------------------------  |
|  -> Match index by index: column[i] <-> type[i]             |
+-------------------------------------------------------------+
|                          ROWS                               |
|  ---------------------------------------------------------  |
|  [ Row 0 ] [ Row 1 ] [ Row 2 ] [ Row 3 ] ...                |
|    Data      Data      Data      Data                       |
|  ---------------------------------------------------------  |
|  - Fixed size per element (depends on type)                 |
|  - Stored sequentially like an Array                        |
|  - Fast access via relative pointer (index lookup)          |
+-------------------------------------------------------------+
|                         TOMBSTONES                          |
|  ---------------------------------------------------------  |
|  When a row is deleted:                                     |
|   - Its space is filled with 0xFF (255u8)                   |
|   - Pointer pushed into in-memory [ Graveyard (BTreeSet) ]  |
|       Capacity: 12,500 pointers                             |
|   - Future inserts may reuse space                          |
|   - If not reused -> Vacuum cleans leftover tombstones      |
+-------------------------------------------------------------+
```