# MVCC

MVCC (Multi-Version Concurrency Control) is a mutex-protected hashmap that every container has in memory. Insertions into this structure are done so that the Commit operation can flush the data changes from it to the container file. After every insertion into the MVCC, appends are made to the MVCC WAL (Write-Ahead Log), which gets an fsync after every append. Both the append and fsync are run asynchronously to avoid blocking the operation that performed the push.

```
          +--------------------+
          |      Container     |
          |      (in-memory)   |
          |   MVCC (HashMap)   |
          +---------+----------+
                    |
    Insert / Push  | (async)
                    v
          +--------------------+
          |   MVCC WAL (Log)   |
          |  append + fsync    |
          +--------------------+
                    |
       Commit flush | 
                    v
          +--------------------+
          |   Container File   |
          |  (on disk storage) |
          +--------------------+

```