# Operations

## Create a Container
Creates a container using as arguments a tuple of arrays: the first one being a string array and the second one a byte array for generating the metadata. The last argument is a string that specifies the container name.

## Create Row
Creates a row in a container using the following arguments: an array of strings, an array of values, and a string. The first and second arrays implement the row layout; it is not necessary to mention all the values of all columns to create a row. When not mentioned, the value's zero is assigned. This makes the explicit definition of primary keys desirable, although not required.

## Edit Row
Makes a search in the specified container and edits the rows (edits go into the MVCC) returned by the search operation. This operation has four parameters: the first is an array of text which contains the names of the columns being edited, the second is the new values, the third is the name of the container that the operation will run on, and the last is a condition set for the search operation to filter the rows that match these conditions and edit only those rows.

## Delete Row
Performs a search in the specified container and deletes the rows the search returns. It requires two arguments: the container name to specify where the operation will run, and the condition set for the search.

## Delete Container
Deletes a container. It receives a container name as an argument.

## Search
Uses the query_type internal function to determine what sort of search must be done based on the condition set; the possible sorts are either scans or indexed searches. An indexed search uses the index hashmap to get a row, while a scan searches the dataset, returning the results of the rows matching the conditions (all rows if no conditions are entered). The operation requires three arguments: the first one is a string array that determines what columns are going to be fetched, the second is a string (container name) that determines the container where the operation will be run.

## Commit
The Commit operation flushes data from the MVCC to the container file. It first iterates through the MVCC, gathering the data within it and detecting what must be written. There is a flag on every element in the MVCC structure that determines whether it is a deletion or not. If it is a deletion, the operation will write into the file at the row location an array of "full" bytes (0xFF or 255u8) with the same size as the original data and remove entries from the index file with the same key as the deleted row. Insertions can be either an insertion or an edit (the process is very similar in practice). For insertions, the commit writes the serialized row at the location it must be at and inserts into the hashmap the pointer to that row using the primary key as the key. Edits are similar to insertions; the only difference is that before writing the index into the hashmap, it removes entries with the old primary key to avoid collisions of any sort.


## Rollback
Clears the MVCC and graveyard, effectively discarding all pending changes and reverting the database to its state before the transaction began.

```
+-----------------------------------------------------------+
|                        OPERATIONS                         |
+-----------------------------------------------------------+

  +--------------------+         +-------------------------+
  | Create Container   |         | Delete Container        |
  |  - metadata (cols) |         |  - name                 |
  |  - name            |         |                         |
  +--------------------+         +-------------------------+

  +--------------------+         +-------------------------+
  | Create Row         |         | Delete Row              |
  |  - column names    |         |  - container name       |
  |  - values          |         |  - condition set        |
  |  - container name  |         |                         |
  +--------------------+         +-------------------------+

  +--------------------+         +-------------------------+
  | Edit Row           |         | Search                  |
  |  - columns to edit |         |  - columns to fetch     |
  |  - new values      |         |  - container name       |
  |  - container name  |         |  - conditions           |
  |  - conditions      |         |  -> [ Indexed | Scan ]  |
  +--------------------+         +-------------------------+

  +--------------------+         +-------------------------+
  | Commit             |         | Rollback                |
  |  - flush MVCC      |         |  - clear MVCC &         |
  |  - write changes   |         |    graveyard            |
  |  - update index    |         |  - discard all changes  |
  +--------------------+         +-------------------------+

+-----------------------------------------------------------+
| Notes:                                                    |
| - All write ops first go into MVCC.                       |
| - Commit makes them permanent.                            |
| - Rollback discards pending changes.                      |
+-----------------------------------------------------------+

```